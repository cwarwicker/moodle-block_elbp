<?php if(!defined('ELBP')) exit; ?>

<p class="elbp_centre"><button class="elbp_b" onclick="validateTargetFormSubmission( $('#elbp_custom_plugin_form') );return false;"><?= $string['save'] ?></button></p>
<br>

<?php if (!$data): ?>
    <p class="elbp_centre"><?= $string['noattributesdefined'] ?></p>
<?php endif; ?>

<div id="custom_output" class="elbp_centre"></div>

<div id="elbp_custom_plugin_edit">
    
    <form id="elbp_custom_plugin_form" action="" method="post">
        
        <table class="custom_plugin_table">
            <tr>
                <th colspan="2" style='<?= $obj->getHeaderStyle() ?>'><?= $obj->getSetting('plugin_summary_title') ?></th>
            </tr>
            <?php foreach($data as $attribute): ?>
            <tr>
                <td><?= $attribute->name ?></td>
                <td><?= $attribute->convertToFormElement(); ?></td>
            </tr>
            <?php endforeach; ?>

            <?php if(isset($notify_choose)): ?>
            <tr>
                <td>Notify<br><small>Send notification to the selected addresses</small></td>
                <td>
                    <select name="notify_choose" multiple="multiple">
                        <?php foreach($notify_choose as $email): ?>
                            <option value="<?= $email ?>"><?= $email ?></option>
                        <?php endforeach; ?>
                    </select>
                </td>
            </tr>
            <?php endif; ?>

        </table>
        
        <input type="hidden" name="itemID" value="<?= $itemID ?>" />

    </form>
    
</div>

<script>
    
    function validateTargetFormSubmission(form)
    {
        if (ELBP.validate_form(form) == true)
        {
            ELBP.Custom.save_multi("<?= $obj->getName() ?>", form );
        }
    }    
    
</script>

<?= \block_elbp\ELBPFORM::getEndCode(); ?>